<!doctype html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>自然码 - 计时版</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                min-height: 100vh;
                margin: 0;
                background-color: #f5f5f5;
                padding: 20px 0;
            }
            .container {
                text-align: center;
                background-color: white;
                padding: 30px;
                border-radius: 10px;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
                width: 80%;
                max-width: 600px;
                margin-bottom: 20px;
            }
            .start-screen, .game-screen {
                display: flex;
                flex-direction: column;
                align-items: center;
            }
            .game-screen {
                display: none;
            }
            .character {
                font-size: 72px;
                margin: 20px 0;
                height: 100px;
            }
            .message {
                height: 24px;
                margin: 10px 0;
                color: #ff4444;
            }
            .stats {
                margin-top: 20px;
                font-size: 14px;
                color: #666;
                display: flex;
                justify-content: space-around;
                width: 100%;
            }
            .instructions {
                margin-top: 30px;
                font-size: 14px;
                color: #666;
            }
            .timer {
                font-size: 24px;
                font-weight: bold;
                color: #2c3e50;
                margin: 15px 0;
            }
            .image-container {
                width: 100%;
                max-width: 600px; /* 与游戏面板同宽 */
                background: white;
                padding: 15px; /* 减小内边距 */
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                text-align: center;
            }
            
            .image-container h2 {
                color: #2c3e50;
                margin-bottom: 12px;
                font-size: 18px; /* 减小标题字号 */
            }
            
            .keyboard-image {
                width: 100%;
                overflow: hidden;
                border-radius: 8px;
            }
            
            .keyboard-image img {
                width: 100%;
                height: auto;
                display: block;
                transition: transform 0.3s ease;
            }
            
            .keyboard-image img:hover {
                transform: scale(1.02);
            }
            
            .image-note {
                margin-top: 10px;
                color: #7f8c8d;
                font-size: 12px; /* 减小备注字号 */
            }
            
            /* 设置界面样式 */
            .settings {
                margin: 20px 0;
                width: 100%;
            }
            
            .settings label {
                display: block;
                margin-bottom: 10px;
                font-weight: bold;
                color: #2c3e50;
            }
            
            .settings input {
                padding: 10px;
                width: 80px;
                border: 1px solid #ddd;
                border-radius: 5px;
                font-size: 16px;
                text-align: center;
            }
            
            .btn {
                background-color: #3498db;
                color: white;
                border: none;
                padding: 12px 24px;
                border-radius: 5px;
                font-size: 16px;
                cursor: pointer;
                margin-top: 20px;
                transition: background-color 0.3s;
            }
            
            .btn:hover {
                background-color: #2980b9;
            }
            
            /* 弹窗样式 */
            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 100;
                justify-content: center;
                align-items: center;
            }
            
            .modal-content {
                background-color: white;
                padding: 30px;
                border-radius: 10px;
                text-align: center;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                max-width: 500px;
                width: 80%;
            }
            
            .modal h2 {
                color: #2c3e50;
                margin-bottom: 20px;
            }
            
            .modal-stats {
                font-size: 18px;
                margin: 20px 0;
                line-height: 1.6;
            }
            
            .modal-stats span {
                font-weight: bold;
                color: #3498db;
            }
            
            @media (max-width: 600px) {
                .container, .image-container {
                    padding: 20px;
                    width: 90%;
                }
                
                h1 {
                    font-size: 1.8rem;
                }
                
                .character {
                    font-size: 60px;
                    height: 90px;
                }
                
                .stats {
                    flex-direction: column;
                    align-items: center;
                    gap: 15px;
                }
                
                .image-container h2 {
                    font-size: 16px;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- 开始界面 -->
            <div class="start-screen" id="startScreen">
                <h1>自然码 - 计时版</h1>
                <div class="settings">
                    <label for="gameTime">设置游戏时间（分钟）:</label>
                    <input type="number" id="gameTime" min="1" max="60" value="3">
                </div>
                <button class="btn" id="startBtn">开始游戏</button>
            </div>
            
            <!-- 游戏界面 -->
            <div class="game-screen" id="gameScreen">
                <h1>自然码韵母练习</h1>
                <div class="timer" id="timer">03:00</div>
                <div class="character" id="character">?</div>
                <div class="message" id="message"></div>
                <div class="stats">
                    <div>正确: <span id="correct">0</span></div>
                    <div>错误: <span id="wrong">0</span></div>
                    <div>准确率: <span id="accuracy">0%</span></div>
                </div>
                <div class="instructions">按下键盘上对应的按键来匹配显示的字符</div>
            </div>
        </div>

        <!-- 键盘指法参考（始终显示） -->
        <div class="image-container" id="keyboardReference">
            <h2>键盘指法参考</h2>
            <div class="keyboard-image">
                <img src="1139407-20241110091209505-220233111.png" alt="键盘指法示意图">
            </div>
            <p class="image-note">鼠标悬停可放大查看细节</p>
        </div>

        <!-- 结束弹窗 -->
        <div class="modal" id="endModal">
            <div class="modal-content">
                <h2>游戏结束!</h2>
                <div class="modal-stats">
                    <p>正确: <span id="finalCorrect">0</span></p>
                    <p>错误: <span id="finalWrong">0</span></p>
                    <p>准确率: <span id="finalAccuracy">0%</span></p>
                </div>
                <button class="btn" id="restartBtn">再玩一次</button>
            </div>
        </div>

        <script>
            // 配置字表和对应的按键
            const characterMap = [
                { char: "iu", key: "Q" },
                { char: "ia", key: "W" },
                { char: "ua", key: "W" },
                { char: "e", key: "E" },
                { char: "uan", key: "R" },
                { char: "ue", key: "T" },
                { char: "ve", key: "T" },
                { char: "ing", key: "Y" },
                { char: "uai", key: "Y" },
                { char: "sh", key: "U" },
                { char: "ch", key: "I" },
                { char: "uo", key: "O" },
                { char: "un", key: "P" },
                { char: "a", key: "A" },
                { char: "iong", key: "S" },
                { char: "ong", key: "S" },
                { char: "iang", key: "D" },
                { char: "uang", key: "D" },
                { char: "en", key: "F" },
                { char: "eng", key: "G" },
                { char: "ang", key: "H" },
                { char: "an", key: "J" },
                { char: "ao", key: "K" },
                { char: "ai", key: "L" },
                { char: "ei", key: "Z" },
                { char: "ie", key: "X" },
                { char: "iao", key: "C" },
                { char: "zh", key: "V" },
                { char: "ui", key: "V" },
                { char: "ou", key: "B" },
                { char: "in", key: "N" },
                { char: "ian", key: "M" },

            ];

            // 状态变量
            let currentChar = null;
            let lastChar = null;
            let correctCount = 0;
            let wrongCount = 0;
            let lastKeyTime = 0; // 记录上次按键时间
            const DEBOUNCE_DELAY = 200; // 防抖延迟时间(毫秒)
            
            // 游戏计时变量
            let gameTimer = null;
            let timeLeft = 0; // 剩余时间（秒）
            let gameActive = false;

            // DOM 元素
            const startScreen = document.getElementById("startScreen");
            const gameScreen = document.getElementById("gameScreen");
            const characterElement = document.getElementById("character");
            const messageElement = document.getElementById("message");
            const correctElement = document.getElementById("correct");
            const wrongElement = document.getElementById("wrong");
            const accuracyElement = document.getElementById("accuracy");
            const timerElement = document.getElementById("timer");
            const gameTimeInput = document.getElementById("gameTime");
            const startBtn = document.getElementById("startBtn");
            const endModal = document.getElementById("endModal");
            const finalCorrectElement = document.getElementById("finalCorrect");
            const finalWrongElement = document.getElementById("finalWrong");
            const finalAccuracyElement = document.getElementById("finalAccuracy");
            const restartBtn = document.getElementById("restartBtn");
            const keyboardReference = document.getElementById("keyboardReference");

            // 随机选择一个字符
            function getRandomChar() {
                const randomIndex = Math.floor(
                    Math.random() * characterMap.length,
                );
                return characterMap[randomIndex];
            }

            // 显示新字符
            function showNewChar() {
                currentChar = getRandomChar();
                while (lastChar == currentChar) {
                    currentChar = getRandomChar();
                }
                lastChar = currentChar;
                characterElement.textContent = currentChar.char;
                messageElement.textContent = "";
            }

            // 更新准确率
            function updateAccuracy() {
                const total = correctCount + wrongCount;
                const accuracy = total > 0 ? Math.round((correctCount / total) * 100) : 0;
                accuracyElement.textContent = `${accuracy}%`;
            }

            // 格式化时间显示
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }

            // 开始游戏
            function startGame() {
                const minutes = parseInt(gameTimeInput.value) || 3;
                timeLeft = minutes * 60;
                
                // 重置游戏状态
                correctCount = 0;
                wrongCount = 0;
                correctElement.textContent = "0";
                wrongElement.textContent = "0";
                accuracyElement.textContent = "0%";
                timerElement.textContent = formatTime(timeLeft);
                
                // 切换界面
                startScreen.style.display = "none";
                gameScreen.style.display = "flex";
                
                // 开始计时
                gameActive = true;
                showNewChar();
                
                gameTimer = setInterval(() => {
                    timeLeft--;
                    timerElement.textContent = formatTime(timeLeft);
                    
                    if (timeLeft <= 0) {
                        endGame();
                    }
                }, 1000);
            }

            // 结束游戏
            function endGame() {
                clearInterval(gameTimer);
                gameActive = false;
                
                // 计算最终准确率
                const total = correctCount + wrongCount;
                const accuracy = total > 0 ? Math.round((correctCount / total) * 100) : 0;
                
                // 更新弹窗内容
                finalCorrectElement.textContent = correctCount;
                finalWrongElement.textContent = wrongCount;
                finalAccuracyElement.textContent = `${accuracy}%`;
                
                // 显示弹窗
                endModal.style.display = "flex";
            }

            // 重新开始游戏
            function restartGame() {
                endModal.style.display = "none";
                gameScreen.style.display = "none";
                startScreen.style.display = "flex";
            }

            // 初始化事件监听
            function initEvents() {
                // 开始按钮
                startBtn.addEventListener("click", startGame);
                
                // 重新开始按钮
                restartBtn.addEventListener("click", restartGame);
                
                // 监听键盘事件
                document.addEventListener("keydown", (event) => {
                    // 如果游戏未开始，忽略按键
                    if (!gameActive) return;
                    
                    // 忽略特殊键
                    if (event.ctrlKey || event.altKey || event.metaKey) {
                        return;
                    }

                    // 防抖处理：如果两次按键间隔太短，忽略后续按键
                    const currentTime = new Date().getTime();
                    if (currentTime - lastKeyTime < DEBOUNCE_DELAY) {
                        return;
                    }
                    lastKeyTime = currentTime;

                    const pressedKey = event.key.toUpperCase();

                    if (pressedKey === currentChar.key) {
                        // 正确按键
                        correctCount++;
                        correctElement.textContent = correctCount;
                        showNewChar();
                    } else {
                        // 错误按键
                        wrongCount++;
                        wrongElement.textContent = wrongCount;
                        messageElement.textContent =
                            "错误! 正确为" + currentChar.key;
                    }
                    
                    // 更新准确率
                    updateAccuracy();
                });
            }

            // 初始化
            function init() {
                initEvents();
            }

            // 启动应用
            init();
        </script>
    </body>
</html>
